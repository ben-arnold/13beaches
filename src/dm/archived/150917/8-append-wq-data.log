--------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /Users/benarnold/dropbox/13beaches/src/dm/8-append-wq-data.log
  log type:  text
 opened on:  17 Sep 2015, 14:21:39

. 
. *----------------------------------------
. * 8-append-wq-data.do
. * ben arnold
. *
. * append the water quality datasets into
. * a single file and calculate quantiles
. * of indicator distributions
. *
. * version 7 (19 aug 2015)
. * updated the quartile calculations to include
. * Enterolert data from Mission Bay
. *
. * version 6 (12 jun 2015)
. * output a codebook for the 13beaches-wq.dta/.csv datasets
. *
. * version 5 (24 apr 2015)
. * revised the indicator quartile calculations
. * to exclude the samples from lagoons in Doheny and Malibu (sites C)
. * since very, very few individuals were exposed at those sites
. * and the measurements are not representative of the distributions
. * experienced in the population
. *
. * version 4 (20 feb 2015)
. * added indicator quantile calculations
. * 
. * version 3 (12 feb 2015)
. * added .csv export
. *
. * version 2 (4 feb 2015)
. * added Mission Bay data
. *
. * version 1 (28 feb 2014)
. *
. *----------------------------------------
. 
. *----------------------------------------
. * input files:
. *       neear-wq.dta
. *   adm-wq.dta
. *   mb-wq.dta
. *
. * output files:
. *       13beaches-wq.dta / .csv
. *
. *----------------------------------------
. 
. 
. *----------------------------------------
. * read in the beaches indicator data
. * append 
. *----------------------------------------
. 
. use "~/dropbox/13beaches/data/final/adm-wq.dta", clear
(Avalon/Doheny/Malibu daily average water quality data, created by 6-format-adm-
> w)

. 
. append using "~/dropbox/13beaches/data/final/mb-wq.dta"
(note: variable beach was str6, now str11 to accommodate using data's values)
(note: variable beachcode was str11, now str13 to accommodate using data's
       values)

. 
. order beach beachcode marine coldate

. 
. append using  "~/dropbox/13beaches/data/final/neear-wq.dta"
(note: variable beach was str11, now str15 to accommodate using data's values)

. 
. *----------------------------------------
. * calculate quartiles of the indicator
. * distribution
. *----------------------------------------
. 
. * Enterococcus EPA 1600 quartiles
. * exclude site C from Malibu and Doheny from the
. * calculation because they are very different
. *
. * use Enterolert data from Mission Bay since that is used in the
. * final calculation
. *
. gen entero = avgdyentero1600
(1 missing value generated)

. replace entero = avgdyenteroELT if beach=="Mission Bay"
(159 real changes made)

. sum entero

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
      entero |        649    1.024187    1.048925         -1   4.612784

. replace entero = . if inlist(beachcode,"Doheny-C","Malibu-C")
(72 real changes made, 72 to missing)

. sum entero, d

                           entero
-------------------------------------------------------------
      Percentiles      Smallest
 1%           -1             -1
 5%    -.5663233             -1
10%      -.23299             -1       Obs                 577
25%     .2114545             -1       Sum of Wgt.         577

50%     .8373417                      Mean           .7868164
                        Largest       Std. Dev.      .7879222
75%     1.380984       2.618365
90%     1.777805       3.017899       Variance       .6208214
95%      1.93435       3.132492       Skewness      -.2103035
99%     2.463414       3.133969       Kurtosis       2.783041

.         local p25 = r(p25)

.         local p50 = r(p50)

.         local p75 = r(p75)

. replace entero = avgdyentero1600 if inlist(beachcode,"Doheny-C","Malibu-C")
(72 real changes made)

. gen int qavgdyentero1600 = 1

.         replace qavgdyentero1600 = 2 if (entero> `p25') & (entero<= `p50')
(144 real changes made)

.         replace qavgdyentero1600 = 3 if (entero> `p50') & (entero<= `p75')
(144 real changes made)

.         replace qavgdyentero1600 = 4 if (entero> `p75') 
(215 real changes made)

.         replace qavgdyentero1600 = . if entero==.
(1 real change made, 1 to missing)

.         label var qavgdyentero1600 "Quartiles of Enterococcus EPA 1600"

.         tab qavgdyentero1600 if !inlist(beachcode,"Doheny-C","Malibu-C")

  Quartiles |
         of |
Enterococcu |
 s EPA 1600 |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        145       25.13       25.13
          2 |        144       24.96       50.09
          3 |        143       24.78       74.87
          4 |        145       25.13      100.00
------------+-----------------------------------
      Total |        577      100.00

.         tab qavgdyentero1600

  Quartiles |
         of |
Enterococcu |
 s EPA 1600 |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        147       22.65       22.65
          2 |        144       22.19       44.84
          3 |        144       22.19       67.03
          4 |        214       32.97      100.00
------------+-----------------------------------
      Total |        649      100.00

.         drop entero 

. 
. * Enterococcus QPCR quartiles
. * exclude site C from Malibu and Doheny from the
. * calculation because they are very different
. sum avgdyenteropcr, d

            Daily Avg log10 Entero qPCR EPA 1611
-------------------------------------------------------------
      Percentiles      Smallest
 1%           -1             -1
 5%    -.2138392             -1
10%     .3645584             -1       Obs                 585
25%     1.034169             -1       Sum of Wgt.         585

50%     1.704074                      Mean            1.61134
                        Largest       Std. Dev.      .9545518
75%     2.233996       3.864311
90%     2.740494       3.872112       Variance       .9111692
95%     2.984678       3.971452       Skewness      -.4489042
99%     3.581618       4.218297       Kurtosis       3.284688

. sum avgdyenteropcr if !inlist(beachcode,"Doheny-C","Malibu-C"), d

            Daily Avg log10 Entero qPCR EPA 1611
-------------------------------------------------------------
      Percentiles      Smallest
 1%           -1             -1
 5%    -.2633322             -1
10%     .3092452             -1       Obs                 530
25%     .9385747             -1       Sum of Wgt.         530

50%     1.585241                      Mean           1.470643
                        Largest       Std. Dev.      .8773644
75%      2.09956       3.152512
90%     2.448108       3.197376       Variance       .7697682
95%     2.668651       3.507966       Skewness      -.6873379
99%     2.984678       3.864311       Kurtosis       3.388075

.         local p25 = r(p25)

.         local p50 = r(p50)

.         local p75 = r(p75)

. gen int qavgdyenteropcr = 1

.         replace qavgdyenteropcr = 2 if (avgdyenteropcr> `p25') & (avgdyenterop
> cr <= `p50')
(133 real changes made)

.         replace qavgdyenteropcr = 3 if (avgdyenteropcr> `p50') & (avgdyenterop
> cr <= `p75')
(133 real changes made)

.         replace qavgdyenteropcr = 4 if (avgdyenteropcr> `p75') 
(251 real changes made)

.         replace qavgdyenteropcr = . if avgdyenteropcr ==.
(65 real changes made, 65 to missing)

.         label var qavgdyenteropcr "Quartiles of Enterococcus EPA qPCR 1611"

.         tab qavgdyenteropcr if !inlist(beachcode,"Doheny-C","Malibu-C")

  Quartiles |
         of |
Enterococcu |
 s EPA qPCR |
       1611 |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        133       25.09       25.09
          2 |        132       24.91       50.00
          3 |        133       25.09       75.09
          4 |        132       24.91      100.00
------------+-----------------------------------
      Total |        530      100.00

.         tab qavgdyenteropcr

  Quartiles |
         of |
Enterococcu |
 s EPA qPCR |
       1611 |      Freq.     Percent        Cum.
------------+-----------------------------------
          1 |        133       22.74       22.74
          2 |        133       22.74       45.47
          3 |        133       22.74       68.21
          4 |        186       31.79      100.00
------------+-----------------------------------
      Total |        585      100.00

. 
. 
. *----------------------------------------
. * save file
. *----------------------------------------
. note: TS 13-Beaches Water Quality Data, created by 8-append-wq-data.do

. note: All indicators are means of log10 values, summarized daily over all samp
> les, or separately for AM, Mid-Day, PM, shin-depth, or waist-depth samples 

. note: The enteropcr2-4 variables are alternative Enterococcus qPCR calculation
> s at Avalon/Doheny/Malibu beaches only

. note: The clat5 series of coliphage indicators are unique to 2 NEEAR beaches (
> Fairhope Goddard) 

. note: The Mission Bay water quality data are separate for 6 beaches within the
>  area and need to merge to individuals separately by beachcode

. note: Avalon water quality data are summarized separately for sites A/B/C and 
> D; site D is very different. See Yau et al 2014 Figs 1 and 2.

. note: Doheny and Malibu water quality data are summarized separately for sites
>  C; at both beaches site C was located in a lagoon. At Doheny, site E is also 
> summarized separately, since it was nearly 1 mile from the other sampling site
> s (See Fig 1 of Arnold et al. 2013 and SI Fig 1 of Colford et al. 2012)

. note: Quartile categories for Entero 1600 and qPCR exclude water quality measu
> rements from Doheny and Malibu sites C in the lagoons because they are not rep
> resentative of the broader swimmer exposure. The Entero 1600 quartiles were ca
> lculated using Enterolert data from Mission Bay

. note: AM/Mid-Day/PM and shin/waist disaggregations were not available for Miss
> ion Bay due to different sampling methods at that beach

. 
. 
. compress
  variable qavgdyentero1600 was int now byte
  variable qavgdyenteropcr was int now byte
  (1,300 bytes saved)

. label data "13 beaches water quality data, created by 8-append-wq-data.do"

. save "~/dropbox/13beaches/data/final/13beaches-wq.dta", replace
file ~/dropbox/13beaches/data/final/13beaches-wq.dta saved

. outsheet using "~/dropbox/13beaches/data/final/13beaches-wq.csv", comma replac
> e

. 
. desc

Contains data from ~/dropbox/13beaches/data/final/13beaches-wq.dta
  obs:           650                          13 beaches water quality data,
                                                created by 8-append-wq-data.do
 vars:            37                          17 Sep 2015 14:21
 size:        98,150                          (_dta has notes)
--------------------------------------------------------------------------------
              storage   display    value
variable name   type    format     label      variable label
--------------------------------------------------------------------------------
beach           str15   %15s                  Beach
beachcode       str13   %13s                  Water quality sampling location
                                                beach code
marine          byte    %8.0g                 Marine beach
coldate         int     %d                    Sample date
avgdyentero1600 float   %9.0g                 Daily Avg log10 Entero EPA 1600
avgamentero1600 float   %9.0g                 AM Avg log10 Entero EPA 1600
avgmdentero1600 float   %9.0g                 Mid-Day Avg log10 Entero EPA 1600
avgpmentero1600 float   %9.0g                 PM Avg log10 Entero EPA 1600
avgdyenteropcr  float   %9.0g                 Daily Avg log10 Entero qPCR EPA
                                                1611
avgamenteropcr  float   %9.0g                 AM Avg log10 Entero qPCR EPA 1611
avgmdenteropcr  float   %9.0g                 Mid-Day Avg log10 Entero qPCR EPA
                                                1611
avgpmenteropcr  float   %9.0g                 PM Avg log10 Entero qPCR EPA 1611
avgdyfpc1601    float   %9.0g                 Daily Avg log10 F+ Coliphage EPA
                                                1601
avgamfpc1601    float   %9.0g                 AM Avg log10 F+ Coliphage EPA 1601
avgmdfpc1601    float   %9.0g                 Mid-Day Avg log10 F+ Coliphage EPA
                                                1601
avgpmfpc1601    float   %9.0g                 PM Avg log10 F+ Coliphage EPA 1601
avgdyfpc1602    float   %9.0g                 Daily Avg log10 F+ Coliphage EPA
                                                1602
avgamfpc1602    float   %9.0g                 AM Avg log10 F+ Coliphage EPA 1602
avgmdfpc1602    byte    %9.0g                 Mid-Day Avg log10 F+ Coliphage EPA
                                                1602
avgpmfpc1602    byte    %9.0g                 PM Avg log10 F+ Coliphage EPA 1602
avgdyfmc1601    float   %9.0g                 Daily Avg log10 F- Coliphage EPA
                                                1601
avgamfmc1601    float   %9.0g                 AM Avg log10 F- Coliphage EPA 1601
avgmdfmc1601    float   %9.0g                 Mid-Day Avg log10 F- Coliphage EPA
                                                1601
avgpmfmc1601    float   %9.0g                 PM Avg log10 F- Coliphage EPA 1601
avgdyfmc1602    float   %9.0g                 Daily Avg log10 F- Coliphage EPA
                                                1602
avgamfmc1602    float   %9.0g                 AM Avg log10 F- Coliphage EPA 1602
avgmdfmc1602    float   %9.0g                 Mid-Day Avg log10 F- Coliphage EPA
                                                1602
avgpmfmc1602    float   %9.0g                 PM Avg log10 F- Coliphage EPA 1602
avgdyenteroELT  float   %9.0g                 Daily Avg log10 Entero Enterolert
avgshentero1600 float   %9.0g                 shin Avg log10 Entero EPA 1600
avgwtentero1600 float   %9.0g                 waist Avg log10 Entero EPA 1600
avgshenteropcr  float   %9.0g                 shin Avg log10 Entero qPCR EPA
                                                1611
avgwtenteropcr  float   %9.0g                 waist Avg log10 Entero qPCR EPA
                                                1611
avgshfpc1601    float   %9.0g                 shin Avg log10 F+ Coliphage EPA
                                                1601
avgwtfpc1601    float   %9.0g                 waist Avg log10 F+ Coliphage EPA
                                                1601
qavgdyente~1600 byte    %8.0g                 Quartiles of Enterococcus EPA 1600
qavgdyenteropcr byte    %8.0g                 Quartiles of Enterococcus EPA qPCR
                                                1611
--------------------------------------------------------------------------------
Sorted by: 

. 
. 
. * write a codebook to separate file
. log close
      name:  <unnamed>
       log:  /Users/benarnold/dropbox/13beaches/src/dm/8-append-wq-data.log
  log type:  text
 closed on:  17 Sep 2015, 14:21:39
--------------------------------------------------------------------------------
