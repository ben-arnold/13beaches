--------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /Users/benarnold/dropbox/13beaches/src/dm/3-format-mb-epi.log
  log type:  text
 opened on:  17 Dec 2015, 13:56:07

. 
. *----------------------------------------
. * 3-format-mb-epi.do
. * ben arnold
. *
. * format the Mission Bay 
. * dataset so that it can be 
. * appended to the other beaches datasets 
. * (NEEAR, Avalon, Doheny, Malibu). 
. *
. *
. * use the NEEAR data as the name template
. * 
. * version 3 (21 feb 2015)
. * retained beachcode to merge to water quality data
. *
. * version 2 (13 nov 2014)
. * final data cleaning
. *
. * version 1 (17 july 2014)
. *
. *----------------------------------------
. 
. *----------------------------------------
. * input files:
. *       mb_analysis_final.dta
. *
. * output files:
. *       mb-epi.dta
. *
. *----------------------------------------
. 
. 
. *----------------------------------------
. * read in the Mission Bay Analysis data
. *----------------------------------------
. 
. 
. use "~/dropbox/13beaches/data/untouched/missionbay/mb_analysis_final.dta", cle
> ar
(SD WET Microbiolgoical Data)

. 
. 
. *----------------------------------------
. * rename variables and subset to be
. * consistent with the NEEAR data
. *----------------------------------------
. 
. 
. 
. 
. * make unique household and individual IDs
. capture drop beach

. gen beach = "MissionBay"

.         label var beach "Beach"

.         
. rename hhid hhid2

. gen hhid = string(hhid2)

.         label var hhid "Household ID"

. 
. gen indid = string(fullid,"%9.0f")

.         label var indid "Individual ID"

. 
. order beach hhid indid

. 
. rename sdate intdate

.         label var intdate "Beach interview date"

. 
. gen _m = floor(catidate/1000000)
(3,603 missing values generated)

. gen _d = floor(catidate/10000)- _m*100
(3,603 missing values generated)

. gen _y = catidate-(_m*1000000)-(_d*10000)
(3,603 missing values generated)

. gen teledate = mdy(_m,_d,_y)
(3,603 missing values generated)

.         format teledate %d

.         label var teledate "Phone interview date"

.         drop _m _d _y

. 
. 
. label var age "age in years"

. 
. * Not Measured: algaemouth
. * Not Measured: algaewash
. 
. rename allergies allergy

.         label var allergy "Has allergies"

. 
. rename saq16a anim_base

. rename oact_a anim_int

.         label var anim_int "Person: contact with animals"

. gen anim_any = (anim_base==1)|(anim_int==1)

.         label var anim_any "Any animal contact"

.         
. rename water anycontact

.         label var anycontact "Any contact with water"

. 
. * Note: for Mission bay, cannot separate out medication use by OTC vs. prescri
> ption
. * any medication use (either OTC or prescription) is stored in the common OTC 
> variables
. rename gh8_h anyotcmeds_ear

.         recode anyotcmeds_ear (5=0)
(anyotcmeds_ear: 85 changes made)

.         label var anyotcmeds_ear "Used OTC medications for syndrome (Ear_infec
> )"

. rename gh7_h anyotcmeds_eye

.         recode anyotcmeds_eye (5=0)
(anyotcmeds_eye: 237 changes made)

.         label var anyotcmeds_eye "Used OTC medications for syndrome (Eye_infec
> )"

. 
. gen anyotcmeds_gas = (gh12_h==1) | (gh13_h==1) | (gh14_h==1) | (gh15_h==1)

.         replace anyotcmeds_gas = . if (gh12_h==.) & (gh13_h==.) & (gh14_h==.) 
> & (gh15_h==.)
(11,747 real changes made, 11,747 to missing)

.         label var anyotcmeds_gas "Used OTC medications for syndrome (GI_illnes
> s)"

.         
. gen anyotcmeds_res = (gh16_h==1) | (gh17_h==1) | (gh18_h==1) | (gh19_h==1)

.         replace anyotcmeds_res = . if (gh16_h==.) & (gh17_h==.) & (gh18_h==.) 
> & (gh19_h==.)
(11,521 real changes made, 11,521 to missing)

.         label var anyotcmeds_res "Used OTC medications for syndrome (Respirato
> ry)"

. rename gh10_h anyotcmeds_skn

.         recode anyotcmeds_skn (5=0)
(anyotcmeds_skn: 187 changes made)

.         label var anyotcmeds_skn "Used OTC medications for syndrome (Skin_Rash
> )"

.         
. * Not Measured: aanyotcmeds_uti
. * Not Measured: aanyprescrdrug_ear
. * Not Measured: aanyprescrdrug_eye
. * Not Measured: aanyprescrdrug_gas
. * Not Measured: aanyprescrdrug_res
. * Not Measured: aanyprescrdrug_skn
. * Not Measured: aanyprescrdrug_uti
. 
. rename chronresp asth

.         label var asth "chronic respiratory problems"

. 
. * Not Measured: berm
. 
. drop block

. rename saq8b block

.         label var block "Wear sunscreen-block today (R)"

. 
. rename water_shoulders bodycontact

.         label var bodycontact "Body contact with water"

. 
. rename buried bsand

.         label var bsand "Had body buried in sand (R)"

. 
. * Not Measured: cold
. * Not Measured: coldallergy
. * Not Measured: colddays
. * Not Measured: coldstdt
. * Not Measured: coldstill
. 
. * Not Measured: come
. 
. * cough is measured 2 ways in MB. combine into one, using the min(start date)
. rename cough cough2

. gen cough = (cough2==1) | (cough_phlegm==1)

.         replace cough = . if (cough2==.) & (cough_phlegm==.)
(3,718 real changes made, 3,718 to missing)

.         label var cough "Person had cough"

. 
.         * clean 3 values with impossible months
.         replace gh16_b1 = 5 if gh16_b1<5 & gh16_b1!=.
(3 real changes made)

. gen coughdt1 = mdy(gh16_b1,gh16_b2,2003)
(12,199 missing values generated)

. gen coughdt2 = mdy(gh17_b1,gh17_b2,2003)
(12,256 missing values generated)

. gen coughstdt = min(coughdt1,coughdt2)
(12,040 missing values generated)

.         drop coughdt1 coughdt2

.         format coughstdt %d

.         label var coughstdt "cough start date"

. 
. * Not Measured: coughallergy
. * Not Measured: coughdays
. * Not Measured: coughstill
. 
. rename scrapes cut

. rename saq12 cutbase

.         label var cutbase "Cut self or have open cut (R)"

. gen cutstdt = mdy(gh11_b1,gh11_b2,2003)
(12,436 missing values generated)

.         format cutstdt %d

.         label var cutstdt "cut start date"

. * Not Measured: cutdays
. * Not Measured: cutstill
. 
. 
. gen diarrheastdt = mdy(gh14_b1,gh14_b2,2003)
(12,095 missing values generated)

.         format diarrheastdt %d

.         label var diarrheastdt "diarrhea start date"

. * Not Measured: diarrheadays
. * Not Measured: diarrheanumber
. * Not Measured: diarrheastill
. 
. * clean 1 apparent data entry error in the diarrhea start date
. replace diarrheastdt = mdy(6,1,2003) if indid=="40004601"
(1 real change made)

. 
. gen differentbeach = (sw1c_c>0 & sw1c_c!=. & sw1c_c!=98) | (sw1d_c>0 & sw1d_c!
> =. & sw1d_c!=98)

.         label var differentbeach "Summary variable: swam at other beach"

.         
. rename saq11 drinksy

.         recode drinksy (2=0)
(drinksy: 10844 changes made)

. 
. * note: sunhr and sunmin not calculable for Mission Bay -- only collected as c
> ategorical data
. * create sunhr_cat rather than sunhr
. rename saq9b sunhr_cat

.         label var sunhr_cat "Total hours in direct sunlight (category)"

.         
. * Not Measured: sunmin  
. 
. 
. * earache and ear discharge need to be combined.  combine into one, using the 
> min(start date)
. rename earache earache2

. gen earache = (earache2==1) | (ear_discharge==1)

.         replace earache = . if (earache2==.) & (ear_discharge==.)
(3,718 real changes made, 3,718 to missing)

.         label var earache "Person had earache/infection/runny ears since beach
>  interview"

. 
. gen eardt1 = mdy(gh8_b1,gh9_b2,2003)
(12,443 missing values generated)

. gen eardt2 = mdy(gh9_b1,gh9_b2,2003)
(12,431 missing values generated)

. gen earachestdt = min(eardt1,eardt2)
(12,431 missing values generated)

.         drop eardt1 eardt2

.         format earachestdt %d

.         label var earachestdt "earache start date"

.         
. * Not Measured: earacheallergy
. * Not Measured: earachedays
. * Not Measured: earachestill
. 
. rename saq6a earplugs

. 
. rename saq10 eatfood

. 
. 
. rename saq15b eggs_base

. rename food_b eggs_int

.         label var eggs_int "Person:eaten runny/raw eggs since interview"

. drop eggs_any

. gen eggs_any = (eggs_base==1)|(eggs_int==1)

.         label var eggs_any "Any undercooked eggs"

. 
. * Not Measured: emergencyroom_ear
. * Not Measured: emergencyroom_eye
. * Not Measured: emergencyroom_gas
. * Not Measured: emergencyroom_res
. * Not Measured: emergencyroom_skn
. * Not Measured: emergencyroom_uti
. 
. rename eye_infection_past eyebase

.         label var eyebase "Eye infection at baseline"

. 
. rename eye_irritation eyeinfection

.         * recode 1 implausible value
.         replace gh7_b2 = 26 if gh7_b2==1 & gh7_b1==1
(1 real change made)

.         replace gh7_b1 = 5 if gh7_b1==1
(1 real change made)

. gen eyeinfectionstdt = mdy(gh7_b1,gh7_b2,2003)
(12,054 missing values generated)

.         format eyeinfectionstdt %d

.         label var eyeinfectionstdt "eye infection start date"

. 
. * Not Measured: eyeinfectiondays
. * Not Measured: eyeinfectionstill
. 
. gen feverstdt = mdy(gh5_b1,gh5_b2,2003)
(12,157 missing values generated)

.         format feverstdt %d

.         label var feverstdt "fever start date"

.         
. * Not Measured: feverdays
. * Not Measured: feverstill
. * Not Measured: fevertemp
. * Not Measured: fevertemptaken
. 
. rename food_e fish_int

.         recode fish_int (5=0)
(fish_int: 7980 changes made)

. rename saq15g fish_base

. gen fish_any = (fish_base==1)|(fish_int==1)

.         label var fish_any "Any raw fish"

. 
. 
. rename saq10a food

. 
. gen gibase = (diarrhea_past==1) | (vomiting_past==1)

.         label var gibase "GI illness at baseline"

.         * flag 1 individual who reported GI symptoms before the interview date
.         replace gibase=1 if indid=="20002502"
(1 real change made)

. 
. 
. rename chrongi gichron

.         label var gichron "Chronic GI problems/Crohn's/IBS"

.         * assume that the large number of individuals with missing values (370
> 3) do not have chronic GI problems
.         replace gichron = 0 if gichron==.
(3,703 real changes made)

. 
. drop gicontact

. rename saq16b gicontact_base

. 
. * Not Measured: groundwater
. 
. * Not Measured: headache
. * Not Measured: headachedays
. * Not Measured: headachestdt
. * Not Measured: headachestill
. 
. rename water_face_under headunder

.         label var headunder "Head under water"

. 
. 
. * household income at MB uses different categories
. * create hhinc_mb
. rename isum hhinc_mb

.         label var hhinc_mb "Household Pre-tax income, 2002 (Mission Bay catego
> ries)"

. 
. * Not Measured: hospitaldays_ear
. * Not Measured: hospitaldays_eye
. * Not Measured: hospitaldays_gas
. * Not Measured: hospitaldays_res
. * Not Measured: hospitaldays_skn
. * Not Measured: hospitaldays_uti
. 
. * Not Measured: hospitalized_ear
. * Not Measured: hospitalized_eye
. * Not Measured: hospitalized_gas
. * Not Measured: hospitalized_res
. * Not Measured: hospitalized_skn
. * Not Measured: hospitalized_uti
. 
. rename saq6d mask

. 
. rename water_mouth mouthwater

. 
. gen nauseastdt = mdy(gh12_b1,gh12_b2,2003)
(12,246 missing values generated)

.         format nauseastdt %d

.         label var nauseastdt "nausea start date"

.         
. * Not Measured: nauseadays
. * Not Measured: nauseastill
. 
. rename saq6b noseplugs

. 
. * Not Measured: othersmiss_ear
. * Not Measured: othersmiss_eye
. * Not Measured: othersmiss_gas
. * Not Measured: othersmiss_res
. * Not Measured: othersmiss_skn
. * Not Measured: othersmiss_uti
. * Not Measured: othersmissdays_ear
. * Not Measured: othersmissdays_eye
. * Not Measured: othersmissdays_gas
. * Not Measured: othersmissdays_res
. * Not Measured: othersmissdays_skn
. * Not Measured: othersmissdays_uti      
. 
. * Not Measured: ownmoneyfordrugs_ear
. * Not Measured: ownmoneyfordrugs_eye
. * Not Measured: ownmoneyfordrugs_gas
. * Not Measured: ownmoneyfordrugs_res
. * Not Measured: ownmoneyfordrugs_skn
. * Not Measured: ownmoneyfordrugs_uti
. * Not Measured: ownmoneyforotc_ear
. * Not Measured: ownmoneyforotc_eye
. * Not Measured: ownmoneyforotc_gas
. * Not Measured: ownmoneyforotc_res
. * Not Measured: ownmoneyforotc_skn
. * Not Measured: ownmoneyforotc_uti
. 
. * Not Measured: phonedoc_ear
. * Not Measured: phonedoc_eye
. * Not Measured: phonedoc_gas
. * Not Measured: phonedoc_res
. * Not Measured: phonedoc_skn
. * Not Measured: phonedoc_uti
. 
. * Not Measured: pool
. 
. rename gh4_a preg

. recode preg (5=0)
(preg: 3005 changes made)

. 
. rename saq8c prothat

. rename saq9a prot

. 
. rename sw2a_a publicpool

. recode publicpool (5=0)
(publicpool: 7454 changes made)

. 
. 
. * create a standardize race category consistent with other beaches
. gen byte race2 = . 
(12,469 missing values generated)

. replace race2 = 1 if race==1 & inlist(hisp,5,.)
(2,211 real changes made)

. replace race2 = 2 if race==1 & inlist(hisp,1,2,3,4)
(284 real changes made)

. replace race2 = 3 if race!=1 & (race==7 | inlist(hisp,1,2,3,4) )
(5,040 real changes made)

. replace race2 = 4 if race==2 & inlist(hisp,5,.)
(356 real changes made)

. replace race2 = 5 if race==4 & inlist(hisp,5,.)
(449 real changes made)

. replace race2 = 6 if race==3 & inlist(hisp,5,.)
(53 real changes made)

. replace race2 = 7 if race==6 & inlist(hisp,5,.)
(241 real changes made)

. replace race2 = 8 if race==5 & inlist(hisp,5,.)
(112 real changes made)

. replace race2 = 9 if race==.
(3,723 real changes made)

. drop race

. label drop race

. label define race 1 "white" 2 "white, hispanic" 3 "non-white, hispanic" 4 "bla
> ck" 5 "asian" 6 "american indian" 7 "multiple races" 8 "other" 9 "missing"

. rename race2 race

. label values race race

. label var race "Racial category"

. 
. * standardize hisp var
. gen byte hisp2 = inlist(hisp,1,2,3,4) | (race==7 & hisp==5)

. drop hisp

. rename hisp2 hisp

. label var hisp "Hispanic"

. 
.         
. rename skin_rash rash

. rename rash_past rashbase

. gen rashstdt = mdy(gh10_b1,gh10_b2,2003)
(12,200 missing values generated)

.         format rashstdt %d

.         label var rashstdt "skin rash start date"

. 
. * Not Measured: rashdays
. * Not Measured: rashstill
. 
. rename food_d rawmeat_int

.         recode rawmeat_int (5=0)
(rawmeat_int: 7733 changes made)

. rename saq15d rawmeat_base

. gen rawmeat_any = (rawmeat_int==1) | (rawmeat_base==1)

.         label var rawmeat_any "Any raw meat"

. 
. gen byte rawfood = (eggs_any==1)|(fish_any==1)|(rawmeat_any==1)

.         label var rawfood "Ate undercooked eggs/meat/fish"

. 
. rename saq8a repel

. 
. rename nasal_congestion runnynose

. 
. gen runnynosestdt = mdy(gh18_b1,gh18_b2,2003)
(11,932 missing values generated)

.         format runnynosestdt %d

.         label var runnynosestdt "congestion/runny nose start date"

. 
. * Not Measured: runnynoseallergy
. * Not Measured: runnynosedays
. * Not Measured: runnynosestill
. 
. gen samebeach = (sw1a_a==1) & (sw1a_b==1)

.         label var samebeach "Swim/wade: same beach"

.         
. * Not Measured: sanddry
. * Not Measured: sandmouth
. * Not Measured: sandwash
. 
. gen shade = prot
(390 missing values generated)

.         label var shade "Use protective equipment (R)"

. 
. rename gh1_b skinchron

. recode skinchron (5=0)
(skinchron: 8289 changes made)

. 
. rename sore_throat_past sorebase

. 
. rename sore_throat sorethroat

. gen sorethroatstdt = mdy(gh19_b1,gh19_b2,2003)
(12,049 missing values generated)

.         format sorethroatstdt %d

.         label var sorethroatstdt "sore throat start date"

. 
. * Not Measured: sorethroatallergy
. * Not Measured: sorethroatdays
. * Not Measured: sorethroatstill
. 
. gen byte stayhome_ear = (gh8_d==1) | (gh9_d==1)

.         replace stayhome_ear = . if (gh8_d==.) & (gh9_d==.)
(12,375 real changes made, 12,375 to missing)

.         label var stayhome_ear "Missed work/school for syndrome (Ear_infec)"

. 
. gen byte stayhome_eye = (gh7_d==1)

.         replace stayhome_eye = . if (gh7_d==.)
(12,279 real changes made, 12,279 to missing)

.         label var stayhome_eye "Missed work/school for syndrome (Eye_infec)"

.         
. gen byte stayhome_gas = (gh12_d==1) | (gh13_d==1) | (gh14_d==1) | (gh15_d==1)

.         replace stayhome_gas = . if (gh12_d==.) & (gh13_d==.) & (gh14_d==.) & 
> (gh15_d==.)
(12,167 real changes made, 12,167 to missing)

.         label var stayhome_gas "Missed work/school for syndrome (GI_illness)"

. gen byte stayhome_res = (gh16_d==1) | (gh17_d==1) | (gh18_d==1) | (gh19_d==1)

.         replace stayhome_res = . if (gh16_d==.) & (gh17_d==.) & (gh18_d==.) & 
> (gh19_d==.)
(12,016 real changes made, 12,016 to missing)

. gen byte stayhome_skn = (gh10_d==1)

.         replace stayhome_skn = . if (gh10_d==.)
(12,389 real changes made, 12,389 to missing)

.         label var stayhome_skn "Missed work/school for syndrome (Skin_rash)"

. 
. * Not Measured: stayhome_uti
. 
. gen stayhomedays_ear = max(gh8_e,gh9_e)
(12,444 missing values generated)

.         label var stayhomedays_ear "Number of days missed from work/school (Ea
> r_infec)"

. gen stayhomedays_eye = gh7_e
(12,457 missing values generated)

.         label var stayhomedays_eye "Number of days missed from work/school (Ey
> e_infec)"

. gen stayhomedays_gas = max(gh12_e,gh13_e,gh14_e,gh15_e)
(12,398 missing values generated)

.         label var stayhomedays_gas "Number of days missed from work/school (GI
> _illness)"

. gen stayhomedays_res = max(gh16_e,gh17_e,gh18_e,gh19_e)
(12,411 missing values generated)

.         label var stayhomedays_res "Number of days missed from work/school (Re
> spiratory)"

. gen stayhomedays_skn = gh10_e
(12,466 missing values generated)

.         label var stayhomedays_skn "Number of days missed from work/school (Sk
> in_rash)"

.         
. * Not Measured: stayhomedays_uti
. * Not Measured: stmatch
. 
. rename cramps stomach

. gen stomachstdt = mdy(gh15_b1,gh15_b2,2003)
(12,081 missing values generated)

.         format stomachstdt %d

.         label var stomachstdt "stomach pain or cramps start date"

. 
. * Not Measured: stomachdays
. * Not Measured: stomachstill
. 
. * NOTE: In Mission Bay, these questions asked about whether an
. * individual -Limited- their daily activities due to the symptoms
. * but for the other beaches the questions asked about whether they
. * -missed- their daily activities due to the symptoms
. 
. gen byte stopdaily_ear = (gh8_f==1) | (gh9_f==1)

.         replace stopdaily_ear = . if (gh8_f==.) & (gh9_f==.)
(12,264 real changes made, 12,264 to missing)

.         label var stopdaily_ear "Missed other activities (Ear_infec)"

. gen byte stopdaily_eye = (gh7_f==1)

.         replace stopdaily_eye = . if (gh7_f==.)
(12,053 real changes made, 12,053 to missing)

.         label var stopdaily_eye "Missed other activities (Eye_infec)"

. gen byte stopdaily_gas = (gh12_f==1) | (gh13_f==1) | (gh14_f==1) | (gh15_f==1)

.         replace stopdaily_gas = . if (gh12_f==.) & (gh13_f==.) & (gh14_f==.) &
>  (gh15_f==.)
(11,746 real changes made, 11,746 to missing)

.         label var stopdaily_gas "Missed other activities (GI_illness)"

. gen byte stopdaily_res = (gh16_f==1) | (gh17_f==1) | (gh18_f==1) | (gh19_f==1)

.         replace stopdaily_res = . if (gh16_f==.) & (gh17_f==.) & (gh18_f==.) &
>  (gh19_f==.)
(11,520 real changes made, 11,520 to missing)

.         label var stopdaily_res "Missed other activities (Respiratory)"

. gen byte stopdaily_skn = gh10_f
(12,199 missing values generated)

.         label var stopdaily_skn "Missed other activities (Skin_rash)"

. 
. * Not Measured: stopdaily_uti
. 
. gen stopdailydays_ear = max(gh8_g,gh9_g)
(12,395 missing values generated)

.         label var stopdailydays_ear "Days missed from other activities (Ear_in
> fec)"

. gen stopdailydays_eye = gh9_g
(12,460 missing values generated)

.         label var stopdailydays_eye "Days missed from other activities (Eye_in
> fec)"

. gen stopdailydays_gas = max(gh12_g,gh13_g,gh14_g,gh15_g)
(12,154 missing values generated)

.         label var stopdailydays_gas "Days missed from other activities (GI_ill
> ness)"

. gen stopdailydays_res  = max(gh16_g,gh17_g,gh18_g,gh19_g)
(12,220 missing values generated)

.         label var stopdailydays_res "Days missed from other activities (Respir
> atory)"

. gen stopdailydays_skn = gh10_g
(12,429 missing values generated)

.         label var stopdailydays_skn "Days missed from other activities (Skin_r
> ash)"

. 
. * Not Measured: stopdailydays_uti
. 
. rename sunburn_past sunbase

. 
. * Not Measured: sunburn
. * Not Measured: sunburndays
. * Not Measured: sunburnstdt
. * Not Measured: sunburnstill
. 
. rename water_swallow swallwater

. 
. gen swam = anycontact
(123 missing values generated)

.         label var swam "Person went swimming/wading"

. 
. * Not Measured: totdays
. 
. * Not Measured: urinarytractinfection
. * Not Measured: urinarytractinfectiondays
. * Not Measured: urinarytractinfectionstdt
. * Not Measured: urinarytractinfectionstill
. * Not Measured: utibase
. 
. 
. gen byte visitdoc_ear = (gh8_c==1) | (gh9_c==1)

.         replace visitdoc_ear = . if (gh8_c==.) & (gh9_c==.)
(12,264 real changes made, 12,264 to missing)

.         label var visitdoc_ear "Visited doctor/nurse/clinic (Ear_infec)"

. gen byte visitdoc_eye = (gh7_c==1)

.         replace visitdoc_eye = . if (gh7_c==.)
(12,053 real changes made, 12,053 to missing)

.         label var visitdoc_eye "Visited doctor/nurse/clinic (Eye_infec)"

. gen byte visitdoc_gas =  (gh12_c==1) | (gh13_c==1) | (gh14_c==1) | (gh15_c==1)

.         replace visitdoc_gas = . if (gh12_c==.) & (gh13_c==.) & (gh14_c==.) & 
> (gh15_c==.)
(11,746 real changes made, 11,746 to missing)

.         label var visitdoc_gas "Visited doctor/nurse/clinic (GI_illness)"

. gen byte visitdoc_res = (gh16_c==1) | (gh17_c==1) | (gh18_c==1) | (gh19_c==1)

.         replace visitdoc_res =. if (gh16_c==.) & (gh17_c==.) & (gh18_c==.) & (
> gh19_c==.)
(11,521 real changes made, 11,521 to missing)

.         label var visitdoc_res "Visited doctor/nurse/clinic (Respiratory)"

. gen byte visitdoc_skn = (gh10_c==1)

.         replace visitdoc_skn = . if (gh10_c==.)
(12,199 real changes made, 12,199 to missing)

.         label var visitdoc_skn "Visited doctor/nurse/clinic (Skin_rash)"

. 
. * Not Measured: visitdoc_uti
. 
. * Not Measured: visitdoctimes_ear
. * Not Measured: visitdoctimes_eye
. * Not Measured: visitdoctimes_gas
. * Not Measured: visitdoctimes_res
. * Not Measured: visitdoctimes_skn
. * Not Measured: visitdoctimes_uti
. 
. * Not Measured: visitertimes_ear
. * Not Measured: visitertimes_eye
. * Not Measured: visitertimes_gas
. * Not Measured: visitertimes_res
. * Not Measured: visitertimes_skn
. * Not Measured: visitertimes_uti
. 
. rename vomiting_past vomitingbase

. gen vomitingstdt = mdy(gh13_b1,gh13_b2,2003)
(12,301 missing values generated)

.         format vomitingstdt %d

.         label var vomitingstdt "vomiting start date"

. 
. * Not Measured: vomitingdays
. * Not Measured: vomitingnumber
. * Not Measured: vomitingstill
. 
. gen watertime = water_minutes/60
(822 missing values generated)

.         label var watertime "Time in water (hrs)"

. 
. * Not Measured: wateryeyes
. * Not Measured: wateryeyesallergy
. * Not Measured: wateryeyesdays
. * Not Measured: wateryeyesstdt
. * Not Measured: wateryeyesstill
. 
. * NOTE: in MB the wave variable only includes windsurfing and "boarding"
. gen byte wave = (saq5c==1) | (saq5f==1)

.         label var wave "boog board/wave rid/surf/windsurf/wake-kite board"

. 
. * NOTE: in MB the working variable includes persons who work or go to school
. rename work working

.         label var working "Person working for pay"

. 
. * Not Measured: beachtype
. * Not Measured: blockface
. * Not Measured: diagnosis_ear
. * Not Measured: diagnosis_eye
. * Not Measured: diagnosis_gas
. * Not Measured: diagnosis_res
. * Not Measured: diagnosis_skn
. * Not Measured: diagnosis_uti
. * Not Measured: gicontact_any
. * Not Measured: gicontact_int
. * Not Measured: lat
. * Not Measured: longi
. * Not Measured: meanbathers
. * Not Measured: miles
. 
. * Not Measured: protbrim
. * Not Measured: protslv
. * Not Measured: reapp
. * Not Measured: seatdr
. * Not Measured: spf
. * Not Measured: statusc
. 
. * Not Measured: sunburn1
. * Not Measured: sunburn2
. * Not Measured: sunburn3
. * Not Measured: sunburn4
. * Not Measured: sunburn5
. * Not Measured: sunburn6
. * Not Measured: sunburn7
. * Not Measured: sunburnother
. 
. * Not Measured: swimloc
. * Not Measured: tanning
. * Not Measured: tanos
. * Not Measured: transect
. * Not Measured: venfest
. 
. recode sex 0=2
(sex: 5590 changes made)

. label define sex 1 "Male" 2 "Female"

. label values sex sex

. 
. recode anim_int eggs_int stopdaily_skn (5=0)
(anim_int: 8380 changes made)
(eggs_int: 8272 changes made)
(stopdaily_skn: 230 changes made)

. 
. * recode variables from 2=0
. local vlist "cutbase eggs_base rawmeat_base fish_base anim_base gicontact_base
>  skinchron block prothat shade repel eatfood food earplugs noseplugs mask preg
>  publicpool fish_int rawmeat_int"

. recode `vlist' (2=0)
(cutbase: 11444 changes made)
(eggs_base: 11143 changes made)
(rawmeat_base: 10392 changes made)
(fish_base: 11775 changes made)
(anim_base: 9652 changes made)
(gicontact_base: 11656 changes made)
(skinchron: 0 changes made)
(block: 5604 changes made)
(prothat: 9291 changes made)
(shade: 7398 changes made)
(repel: 11855 changes made)
(eatfood: 1794 changes made)
(food: 1346 changes made)
(earplugs: 6537 changes made)
(noseplugs: 6580 changes made)
(mask: 6351 changes made)
(preg: 0 changes made)
(publicpool: 0 changes made)
(fish_int: 0 changes made)
(rawmeat_int: 0 changes made)

. 
. 
. *----------------------------------------
. * retain the beach code to merge these
. * data to the water quality data
. *----------------------------------------
. gen beachcode = "Mission Bay " + substr(station,1,1)

.         label var beachcode "Water quality sampling location beach code"

. order beach beachcode

. 
. *----------------------------------------
. * subset the dataset to relevant variables
. *----------------------------------------
. # delimit ;
delimiter now ;
. keep beach beachcode indid hhid intdate teledate age sex 
> watertime 
> earplugs noseplugs mask
> sunhr dig bsand algae
> block prothat shade repel  
> eatfood food drinksy publicpool
> anim_base anim_int anim_any 
> gicontact_base 
> fish_base fish_int fish_any
> rawmeat_base rawmeat_int rawmeat_any
> eggs_base eggs_int eggs_any
> rawfood
> asth gichron skinchron allergy preg 
> anycontact bodycontact headunder mouthwater swallwater wave
> diarrhea nausea vomiting fever sorethroat cough runnynose earache eyeinfection
>  cut rash
> *allergy
> working 
> race hisp
> hhinc
> *_gas *_eye *_res *_ear  *_skn
> *stdt
> stopdaily_gas
> gibase cutbase sorebase eyebase rashbase
> watertime
> swam samebeach differentbeach
> 
> ;

. # delimit cr
delimiter now cr
. 
. * Retained in other datasets, but missing in Mission Bay
. * hhmem wetsuit dsun sanddry sandmouth sandwash algaemouth algaewash come pool
>  diarrheanumber vomitingnumber urinarytractinfection * *_uti *still *days feve
> rtemp* headache cold wateryeyes sunburn racehaw utibase  vomitbase earbase sit
> eid stmatch groundwater berm
. 
. 
. 
. *---------------------------------------------
. * output variable information for harmonization
. *---------------------------------------------
. preserve

. desc, replace clear

. label data "variables for mb-epi.dta"

. save "~/dropbox/13beaches/data/temp/mb-epi-vars.dta", replace
file ~/dropbox/13beaches/data/temp/mb-epi-vars.dta saved

. restore

. 
. 
. 
. *----------------------------------------
. * save the data for combining it with
. * other beaches
. *----------------------------------------
. label data "Mission Bay epi data, created by 3-format-mb-epi.do"

. save "~/dropbox/13beaches/data/final/mb-epi.dta", replace
file ~/dropbox/13beaches/data/final/mb-epi.dta saved

. 
. codebook, c

Variable        Obs Unique      Mean    Min    Max  Label
--------------------------------------------------------------------------------
beach         12469      1         .      .      .  Beach
beachcode     12469      6         .      .      .  Water quality sampling lo...
hhid          12469   4936         .      .      .  Household ID
indid         12469  12469         .      .      .  Individual ID
intdate       12469     30  15906.43  15849  15949  Beach interview date
anycontact    12346      2  .5625304      0      1  Any contact with water
bodycontact   12251      2   .369276      0      1  Body contact with water
headunder     12238      2  .3374734      0      1  Head under water
mouthwater    12204      2  .2299246      0      1  Get Water in Your Mouth
swallwater    12142      2  .1160435      0      1  Swallow Any Water
earplugs       6619      2  .0123886      0      1  WATER ITEMS: Ear Plugs
noseplugs      6619      2  .0058921      0      1  WATER ITEMS: Nose Plugs
mask           6619      2  .0404895      0      1  WATER ITEMS: Goggles or Mask
dig           12165      2  .3515002      0      1  BEACH ACTIVITIES: Dig in ...
bsand         12165      2  .0592684      0      1  Had body buried in sand (R)
algae         12165      2  .0416769      0      1  BEACH ACTIVITIES: Play wi...
repel         12166      2   .025563      0      1  WEAR OR USE: Insect Repel...
block         12166      2   .539372      0      1  Wear sunscreen-block toda...
prothat       12166      2  .2363143      0      1  WEAR OR USE: Hat or Clothing
sunhr_cat     11844      5   2.68178      1      5  Total hours in direct sun...
eatfood       12171      2  .8526004      0      1  Eat Food at the Beach
food           9991      2  .8652788      0      1  IF YES: Food from Home
drinksy       12098      2  .1036535      0      1  Drink Alcohol at the Beach
cutbase       12136      2  .0570204      0      1  Cut self or have open cut...
eggs_base     12233      2  .0891032      0      1  IF YES: Raw or Runny Eggs
rawmeat_base  12233      2  .1504946      0      1  IF YES: Meat (Medium Rare)
fish_base     12233      2  .0374397      0      1  IF YES: Raw Seafood
anim_base     12079      2  .2009272      0      1  IF YES: Contact with Anim...
gicontact_~e  12079      2  .0350195      0      1  IF YES: Contact w/Lower G...
sorebase      12073      2  .0415804      0      1  PAST 3 DAYS: Sore Throat
eyebase       12073      2  .0082001      0      1  Eye infection at baseline
rashbase      12073      2  .0162346      0      1  PAST 3 DAYS: Rash
age           12256     88  24.09334      1     95  age in years
sex           12320      2  1.453734      1      2  Gender on consent form
skinchron      8772      2  .0550616      0      1  Have skin problems such a...
working        5513      2  .7003446      0      1  Person working for pay
preg           3143      2  .0439071      0      1  Currently pregnant
fever          8751      2  .0356531      0      1  Fever since beach interview
eyeinfection   8750      2  .0475429      0      1  Redness or eye irritation...
anyotcmeds~e    415      2  .4289157      0      1  Used OTC medications for ...
anyotcmeds~r    193      2  .5595855      0      1  Used OTC medications for ...
rash           8750      2  .0308571      0      1  Skin rash since beach int...
anyotcmeds~n    270      2  .3074074      0      1  Used OTC medications for ...
cut            8751      2   .003771      0      1  Cuts or scrapes that beca...
nausea         8746      2  .0254974      0      1  Nausea since beach interview
vomiting       8750      2     .0192      0      1  Vomiting since beach inte...
diarrhea       8751      2   .042738      0      1  Diarrhea since beach inte...
runnynose      8751      2  .0617072      0      1  Nasal congestion or runny...
sorethroat     8750      2  .0482286      0      1  Sore throat since beach i...
publicpool     8760      2  .1490868      0      1  Swam in a private pool si...
eggs_int       8741      2  .0536552      0      1  Person:eaten runny/raw eg...
rawmeat_int    8739      2  .1151161      0      1  Ate meat red in the cente...
fish_int       8738      2  .0867475      0      1  Ate raw seafood since bea...
anim_int       8753      2   .042614      0      1  Person: contact with animals
hhinc_mb       8136     19  8.100664      1     19  Household Pre-tax income,...
allergy        8765      2  .1168283      0      1  Has allergies
gichron       12469      2  .0174834      0      1  Chronic GI problems/Crohn...
asth           8769      2     .0658      0      1  chronic respiratory problems
teledate       8866     96  15917.46  15860  15964  Phone interview date
anim_any      12469      2  .2130083      0      1  Any animal contact
anyotcmed~as    722      2   .398892      0      1  Used OTC medications for ...
anyotcmed~es    948      2  .5021097      0      1  Used OTC medications for ...
cough          8751      2  .0493658      0      1  Person had cough
coughstdt       429    112  15904.54  15826  15963  cough start date
cutstdt          33     25  15917.18  15857  15955  cut start date
diarrheastdt    374     94   15910.9  15849  15961  diarrhea start date
differentb~h  12469      2  .0388965      0      1  Summary variable: swam at...
earache        8751      2  .0234259      0      1  Person had earache/infect...
earachestdt      38     31  15903.53  15715  15960  earache start date
eggs_any      12469      2   .117732      0      1  Any undercooked eggs
eyeinfecti~t    415     99  15907.13  15828  15962  eye infection start date
feverstdt       312    100  15912.81  15845  15963  fever start date
fish_any      12469      2  .0907049      0      1  Any raw fish
gibase        12469      2  .0233379      0      1  GI illness at baseline
nauseastdt      223     88  15908.69  15810  15958  nausea start date
race          12469      9  4.649611      1      9  Racial category
hisp          12469      2  .4432593      0      1  Hispanic
rashstdt        269     78   15913.3  15851  15958  skin rash start date
rawmeat_any   12469      2  .2054696      0      1  Any raw meat
rawfood       12469      2  .3268105      0      1  Ate undercooked eggs/meat...
runnynoses~t    537    106  15907.98  15826  15963  congestion/runny nose sta...
samebeach     12469      2   .029834      0      1  Swim/wade: same beach
shade         12079      2  .3875321      0      1  Use protective equipment (R)
sorethroat~t    420    107  15907.49  15826  15962  sore throat start date
stayhome_ear     94      2  .2659574      0      1  Missed work/school for sy...
stayhome_eye    190      2  .0631579      0      1  Missed work/school for sy...
stayhome_gas    302      2  .2384106      0      1  Missed work/school for sy...
stayhome_res    453      2  .1302428      0      1  
stayhome_skn     80      2     .0375      0      1  Missed work/school for sy...
stayhomeda~r     25      6      2.32      1      7  Number of days missed fro...
stayhomeda~e     12      6      3.25      1      7  Number of days missed fro...
stayhomed~as     71      8  2.070423      1     14  Number of days missed fro...
stayhomed~es     58      7   2.12069      1     13  Number of days missed fro...
stayhomeda~n      3      2  2.333333      1      5  Number of days missed fro...
stomachstdt     388    105  15910.67  15810  15962  stomach pain or cramps st...
stopdaily_~r    205      2  .3707317      0      1  Missed other activities (...
stopdaily_~e    416      2     .1875      0      1  Missed other activities (...
stopda~y_gas    723      2   .439834      0      1  Missed other activities (...
stopda~y_res    949      2  .2644889      0      1  Missed other activities (...
stopdaily_~n    270      2  .1481481      0      1  Missed other activities (...
stopdailyd~r     74      9  3.175676      1     14  Days missed from other ac...
stopdailyd~e      9      5  4.111111      2      7  Days missed from other ac...
stopda~s_gas    315     10  2.780952      1     98  Days missed from other ac...
stopda~s_res    249     12  3.192771      1     14  Days missed from other ac...
stopdailyd~n     40      9     3.625      1     11  Days missed from other ac...
swam          12346      2  .5625304      0      1  Person went swimming/wading
visitdoc_ear    205      2  .3073171      0      1  Visited doctor/nurse/clin...
visitdoc_eye    416      2  .1538462      0      1  Visited doctor/nurse/clin...
visitdoc_gas    723      2  .1355463      0      1  Visited doctor/nurse/clin...
visitdoc_res    948      2  .1276371      0      1  Visited doctor/nurse/clin...
visitdoc_skn    270      2  .1518519      0      1  Visited doctor/nurse/clin...
vomitingstdt    168     76  15911.33  15850  15960  vomiting start date
watertime     11647     99  1.031493      0     15  Time in water (hrs)
wave          12469      2  .0056941      0      1  boog board/wave rid/surf/...
--------------------------------------------------------------------------------

. 
. log close
      name:  <unnamed>
       log:  /Users/benarnold/dropbox/13beaches/src/dm/3-format-mb-epi.log
  log type:  text
 closed on:  17 Dec 2015, 13:56:10
--------------------------------------------------------------------------------
